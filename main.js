(()=>{"use strict";function e(e){e.classList.add("popup_is-opened"),document.addEventListener("keydown",r),document.addEventListener("click",o)}function t(e){e.classList.remove("popup_is-opened"),document.removeEventListener("keydown",r),document.removeEventListener("click",o)}function r(e){if("Escape"===e.key){const e=document.querySelector(".popup_is-opened");e&&t(e)}}function o(e){e.target.classList.contains("popup")&&t(e.target)}const n={baseUrl:"https://nomoreparties.co/v1/wff-cohort-30",headers:{authorization:"862c22fe-fcd9-4bbf-9c6f-5c11db01764c","Content-Type":"application/json"}},c=e=>e.ok?e.json():Promise.reject(`Ошибка: ${e.status}`);function a(e){return fetch(`${n.baseUrl}/cards/likes/${e}`,{method:"PUT",headers:n.headers}).then((e=>c(e)))}function u(e){return fetch(`${n.baseUrl}/cards/likes/${e}`,{method:"DELETE",headers:n.headers}).then((e=>c(e)))}const s=document.querySelector("#card-template").content;function l(e,t,r,o,n){const c=s.cloneNode(!0).querySelector(".places__item"),a=c.querySelector(".card__image"),u=c.querySelector(".card__title"),l=c.querySelector(".card__delete-button"),i=c.querySelector(".card__like-button"),p=c.querySelector(".card__like-count");a.src=e.link,a.alt=e.name,u.textContent=e.name,p.textContent=e.likes.length;const d=e._id;return e.owner._id!==n?l.remove():l.addEventListener("click",(()=>{r(c,d)})),i.addEventListener("click",(e=>{t(e,d,p)})),a.addEventListener("click",o),c}function i(e,t){(function(e){return fetch(`${n.baseUrl}/cards/${e}`,{method:"DELETE",headers:n.headers}).then((e=>c(e)))})(t).then((()=>{e.remove()})).catch((e=>{console.error(`Ошибка удаления карты лайка: ${e}`)}))}function p(e,t,r){const o=e.target,n=o.classList.contains("card__like-button_is-active");(n?u:a)(t).then((e=>{r.textContent=e.likes.length,o.classList.toggle("card__like-button_is-active",!n)})).catch((e=>{console.error(`Ошибка изменения лайка: ${e}`)}))}function d(e,t,r){const o=e.querySelector(`.${t.name}-error`);t.classList.remove(r.inputErrorClass),o.textContent="",o.classList.remove(r.errorClass)}function _(e,t,r){!function(e){return e.some((e=>!e.validity.valid))}(e)?(t.classList.remove(r.inactiveButtonClass),t.disabled=!1):(t.classList.add(r.inactiveButtonClass),t.disabled=!0)}function m(e,t){const r=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);r.forEach((r=>{d(e,r,t),r.value=""})),_(r,o,t)}const y=document.querySelector(".places__list");function f(t){const r=t.target.parentElement.querySelector(".card__image");if(r){const t=r.closest(".card").querySelector(".card__title").textContent;H.textContent=t,I.src=r.src,I.alt=t,e(J)}}fetch(`${n.baseUrl}/cards`,{headers:n.headers}).then((e=>c(e))).then((e=>{e.forEach((e=>{const t=l(e,p,i,f,$);y.append(t)}))}));const v=document.querySelector(".popup_type_edit"),h=v.querySelector(".popup__input_type_name"),S=v.querySelector(".popup__input_type_description"),b=document.querySelector(".profile__edit-button"),q=v.querySelector(".popup__close"),E=document.querySelector(".profile__title"),L=document.querySelector(".profile__description"),C=v.querySelector(".popup__form"),k=v.querySelector(".popup__button"),g=document.querySelector(".profile__image");let $;fetch(`${n.baseUrl}/users/me`,{headers:n.headers}).then((e=>c(e))).then((e=>{$=e._id,E.textContent=e.name,L.textContent=e.about,g.style.backgroundImage=`url(${e.avatar})`})),b.addEventListener("click",(()=>{m(C,F),e(v)})),q.addEventListener("click",(()=>t(v))),C.addEventListener("submit",(function(e){e.preventDefault();const r={name:h.value,about:S.value};var o,a;k.textContent="Сохранение...",(o=r.name,a=r.about,fetch(`${n.baseUrl}/users/me`,{method:"PATCH",headers:n.headers,body:JSON.stringify({name:o,about:a})}).then((e=>c(e)))).then((e=>{E.textContent=e.name,L.textContent=e.about,t(v)})).catch((e=>{console.error(`Ошибка обновления данных пользователя: ${e}`)})).finally((()=>{k.textContent="Сохранить"}))}));const x=document.querySelector(".popup_type_new-card"),U=document.querySelector(".profile__add-button"),A=document.querySelector(".popup__input_type_card-name"),B=document.querySelector(".popup__input_type_url"),T=x.querySelector(".popup__form"),D=x.querySelector(".popup__button"),w=x.querySelector(".popup__close");D.addEventListener("click",(()=>t(x))),U.addEventListener("click",(()=>{m(T,F),e(x)})),T.addEventListener("submit",(function(e){e.preventDefault();const r=A.value,o=B.value;var a,u;D.textContent="Сохранение...",(a=r,u=o,fetch(`${n.baseUrl}/cards`,{method:"POST",headers:n.headers,body:JSON.stringify({name:a,link:u})}).then((e=>c(e)))).then((r=>{const o=l(r,p,i,f);y.prepend(o),t(x),e.target.reset()})).catch((e=>{console.error(`Ошибка добавления карточки: ${e}`)})).finally((()=>{D.textContent="Сохранить"}))})),w.addEventListener("click",(()=>t(x)));const P=document.querySelector(".popup_type_edit_avatar"),N=P.querySelector(".popup__input_type_url_avatar"),O=P.querySelector(".popup__close"),j=P.querySelector(".popup__button");document.querySelector(".profile_image__container").addEventListener("click",(()=>{N.value="",m(z,F),e(P)})),P.addEventListener("submit",(function(e){e.preventDefault();const r=N.value;var o;j.textContent="Сохранение...",(o=r,fetch(`${n.baseUrl}/users/me/avatar`,{method:"PATCH",headers:n.headers,body:JSON.stringify({avatar:o})}).then((e=>c(e)))).then((r=>{g.style.backgroundImage=`url(${r.avatar})`,t(P),e.target.reset()})).catch((e=>{console.error(`Ошибка изменения аватара: ${e}`)})).finally((()=>{j.textContent="Сохранить"}))})),O.addEventListener("click",(()=>t(P)));const J=document.querySelector(".popup_type_image"),H=J.querySelector(".popup__caption"),I=J.querySelector(".popup__image");var M;J.querySelector(".popup__close").addEventListener("click",(()=>t(J))),M={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"},Array.from(document.querySelectorAll(M.formSelector)).forEach((e=>{e.addEventListener("submit",(e=>{e.preventDefault()})),function(e,t){const r=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);_(r,o,t),r.forEach((n=>{n.addEventListener("input",(()=>{!function(e,t,r){const o=t.dataset.errorMsg||t.validationMessage;t.validity.valid?d(e,t,r):function(e,t,r,o){const n=e.querySelector(`.${t.name}-error`);t.classList.add(o.inputErrorClass),n.textContent=r,n.classList.add(o.errorClass)}(e,t,o,r)}(e,n,t),_(r,o,t)}))}))}(e,M)}));const z=document.querySelector(".popup__form"),F={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"};m(z,F)})();